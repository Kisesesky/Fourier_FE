# 2025-11-19 작업 요약

## 주요 변경
- `components/layout/Sidebar.tsx`를 아이콘 레일 + 도메인별 서브 패널 구조로 재작성했습니다. 아이콘 레일은 테마 토큰(`bg-sidebar`, `text-sidebar-foreground`)을 사용해 라이트/다크/시스템 모드를 자동으로 따르고, 활성 탭은 `bg-sidebar-primary` 색으로 강조됩니다.
- Chat을 선택하면 우측 패널에 그룹 채널/DM 목록이 나타나고, 채널을 고르면 바로 라우팅됩니다. Issues, Calendar, Members, Docs를 선택하면 각각 워크플로 트리, 기본 캘린더, 즐겨찾기 구성원, 문서 폴더가 폴더형 리스트로 표시됩니다.
- 하단 설정 아이콘은 `workspace:open-settings` 커스텀 이벤트를 발행해 어디서든 WorkspaceSettingsModal을 열 수 있으며, Support 아이콘은 고객센터 메일을 엽니다.
- `app/(workspace)/workspace/[teamId]/[projectId]/layout.tsx`에서 새 사이드바 폭(360px)을 적용하고, `workspace:open-settings` 이벤트를 구독해 모달을 동기화했습니다.
- 문서 데이터 시스템(LocalStorage 기반 Option A) 전면 리팩토링
docs/_model/docs.ts 전체를 재설계하여 create / read / update / delete / move / rename / multi-location까지 풀 스택 기능을 안정적으로 동작하도록 구축.
모든 문서(DocMeta)는 content가 없을 경우 자동으로 { type: "doc", content: [] }이 채워지도록 처리.
문서 및 폴더의 변경 시 docs:refresh 이벤트가 자동 발행되어 UI를 실시간 유지.
- 초기 docs Mock 데이터 시스템 통합
mocks.ts의 MOCK_FOLDERS, MOCK_DOCS를 첫 실행 시 자동 로딩하도록 구성.
모든 mock 문서에 Tiptap JSONContent를 기본 적용해 편집기와의 타입 충돌 제거.
- 문서 트리(note-drive/tree) 전체 구축
useDocTree로 폴더/문서를 트리 구조(TreeNode)로 변환하는 안정적 빌더 구현.
useTreeDrag로 문서/폴더 드래그 이동 구현 완료. (사이클 방지 포함)
DocNode, FolderNode, DocsTree를 전체 재작성하여:
드래그 이동, 우클릭 메뉴, hover 스타일, Lucide 아이콘 적용 기능을 모두 통합.
TreeContextMenu 완성. 이름 변경 / 삭제 / 닫기 모두 정상 동작.
TreeToolbar는 shadcn 없이 순수 Tailwind 기반으로 예쁜 UI로 재구성. 아이콘 버튼 + 모달 형태의 생성 UI 적용.
- 문서 편집기 DocView 안정화
Tiptap SSR 에러(immediatelyRender) 제거. 페이지 이동 시 내용 자동 반영.
getDocOutline / createDocOutline 분리 및 최신화. mock 문서 클릭 → 문서 편집기 정상 이동 완성.
- 라우팅 및 페이지 구조 재정비
[docId]/page.tsx, docs/page.tsx 개편 → 문서 클릭 시 편집기로 정확히 이동.
Sidebar Docs 패널에서도 정확히 이동하도록 리팩토링.

## 검증
- `npm run build` → ✅ (Next.js 14.2.5 프로덕션 빌드 통과)

## 다음 제안
1. 사용되지 않는 `hooks/useSidebarCollapse.ts`를 완전히 제거하거나 다른 레이아웃에도 재활용할지 결정합니다.
2. Sidebar 서브 패널 데이터를 실제 API/스토어와 연결해 폴더/캘린더/워크플로 편집이 실시간으로 반영되도록 확장하면 좋겠습니다.
3. DocsTree에 문서 검색(Search) 패널 추가.
4. 태그 기반 문서 분류 기능 추가.
5. 문서 수 증가에 대비한 virtualization 고려.